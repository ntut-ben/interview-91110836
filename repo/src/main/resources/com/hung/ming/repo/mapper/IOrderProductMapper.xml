<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hung.ming.repo.mapper.IOrderProductMapper">

    <select id="findByIdWithLock" parameterType="OrderProductId" resultMap="OrderProductMap">
        select *
        from ORDER_PRODUCT
        where ORDER_ID = #{orderId}
          and PRODUCT_ID = #{productId} for update
    </select>
    <resultMap id="OrderProductMap" type="OrderProduct">
        <id property="id.orderId" column="ORDER_ID"/>
        <id property="id.productId" column="PRODUCT_ID"/>
        <result property="quantity" column="QUANTITY"/>
        <result property="price" column="PRICE"/>
    </resultMap>

    <insert id="save" parameterType="OrderProduct">
        insert into ORDER_PRODUCT
        values (#{id.orderId}, #{id.productId}, #{quantity}, #{price})
    </insert>

    <update id="update" parameterType="OrderProduct">
        update ORDER_PRODUCT
        set QUANTITY = #{quantity},
            PRICE    = #{price}
        where ORDER_ID = #{id.orderId}
          and PRODUCT_ID = #{id.productId}</update>


</mapper>
